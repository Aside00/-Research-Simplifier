# -*- coding: utf-8 -*-
"""Research Simplifier.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1KfKQqAaFPVre5CXT55UAkFvJJkJajFeH
"""

!pip install gradio PyPDF2 openai --quiet

import os
import gradio as gr
from PyPDF2 import PdfReader
from openai import OpenAI

client = OpenAI(api_key="sk...")

def extract_text_from_pdf(file_path):
    text = ""
    reader = PdfReader(file_path)
    for page in reader.pages:
        text += page.extract_text() + "\n"
    return text

def summarize_text(text: str) -> str:
    system_prompt = (
        "Ø£Ù†Øª Ù…Ø­Ø±Ø± Ø¹Ù„Ù…ÙŠ Ø¹Ø±Ø¨ÙŠ. Ù„Ø®Øµ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø·Ø±ÙŠÙ‚Ø© Ù…Ù†Ø¸Ù…Ø© ÙˆØ³Ù‡Ù„Ø© Ù„ØºÙŠØ± Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†."
    )

    user_prompt = f"""
Ù‡Ø°Ø§ Ù†Øµ Ù…Ù† Ø¨Ø­Ø« Ø¹Ù„Ù…ÙŠ:

{text[:5000]}  # Ù†Ø­Ø¯Ø¯ Ø£ÙˆÙ„ 5000 Ø­Ø±Ù Ø¹Ø´Ø§Ù† Ù…Ø§ ÙŠØ²ÙŠØ¯ Ø§Ù„Ø·ÙˆÙ„

Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ùƒ:
1) **Ø£Ø¨Ø±Ø² Ø«Ù„Ø§Ø« Ø£ÙÙƒØ§Ø±** Ù…Ù† Ø§Ù„Ø¨Ø­Ø« (Ø¨Ø§Ù„Ø¶Ø¨Ø· 3 Ù†Ù‚Ø§Ø·).
2) **ØªØ¨Ø³ÙŠØ· Ø§Ù„Ù‡Ø¯Ù ÙˆØ§Ù„Ù†ØªÙŠØ¬Ø©** Ù„ØºÙŠØ± Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†ØŒ Ø¨ØµÙŠØ§ØºØ© Ø³Ù‡Ù„Ø©.
Ù†Ø³Ù‘Ù‚ Ø§Ù„Ù†Ø§ØªØ¬ ÙƒÙ€ Markdown.
"""

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=[
            {"role": "system", "content": system_prompt},
            {"role": "user", "content": user_prompt},
        ],
        max_tokens=800
    )

    return response.choices[0].message.content

def process_pdf(file_path):
    try:
        text = extract_text_from_pdf(file_path)
        summary = summarize_text(text)
        return summary
    except Exception as e:
        return f" Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: {str(e)}"

with gr.Blocks(theme="soft") as demo:
    gr.Markdown("## ğŸ“‘ ØªØ¨Ø³ÙŠØ· Ø§Ù„Ø£Ø¨Ø­Ø§Ø«\n### Ø§Ø±ÙØ¹ Ø£ÙŠ Ø¨Ø­Ø« PDF ÙˆØ³ÙŠØªÙ… ØªØ¨Ø³ÙŠØ·Ù‡ Ù„ØºÙŠØ± Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†")

    with gr.Row():
        file_input = gr.File(label="ğŸ“¤ Ø§Ø±ÙØ¹ Ù…Ù„Ù PDF", type="filepath", file_types=[".pdf"])

    with gr.Row():
        output = gr.Markdown()

    summarize_btn = gr.Button("ğŸš€ Ù„Ø®Øµ Ø§Ù„Ø¢Ù†")
    summarize_btn.click(fn=process_pdf, inputs=file_input, outputs=output)

demo.launch()